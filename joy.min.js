/*
 * Name          : joy.js
 * @author       : Roberto D'Amico (Bobboteck)
 * Last modified : 09.06.2020
 * Revision      : 1.1.6
 *
 * Modification History:
 * Date         Version     Modified By     Description
 * 2021-12-21   2.0.0       Roberto D'Amico New version of the project that integrates the callback functions, while 
 *                                          maintaining compatibility with previous versions. Fixed Issue #27 too, 
 *                                          thanks to @artisticfox8 for the suggestion.
 * 2020-06-09   1.1.6       Roberto D'Amico Fixed Issue #10 and #11
 * 2020-04-20   1.1.5       Roberto D'Amico Correct: Two sticks in a row, thanks to @liamw9534 for the suggestion
 * 2020-04-03               Roberto D'Amico Correct: InternalRadius when change the size of canvas, thanks to 
 *                                          @vanslipon for the suggestion
 * 2020-01-07   1.1.4       Roberto D'Amico Close #6 by implementing a new parameter to set the functionality of 
 *                                          auto-return to 0 position
 * 2019-11-18   1.1.3       Roberto D'Amico Close #5 correct indication of East direction
 * 2019-11-12   1.1.2       Roberto D'Amico Removed Fix #4 incorrectly introduced and restored operation with touch 
 *                                          devices
 * 2019-11-12   1.1.1       Roberto D'Amico Fixed Issue #4 - Now JoyStick work in any position in the page, not only 
 *                                          at 0,0
 * 
 * The MIT License (MIT)
 *
 *  This file is part of the JoyStick Project (https://github.com/bobboteck/JoyStick).
 *	Copyright (c) 2015 Roberto D'Amico (Bobboteck).
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
const JoyStickEventType={None:0,Press:1,PressMove:2,Release:3};let StickStatus={xPosition:0,yPosition:0,x:0,y:0,cardinalDirection:"C",eventType:JoyStickEventType.None};var JoyStick=function(t,e,i){var o=void 0===(e=e||{}).title?"joystick":e.title,n=void 0===e.width?0:e.width,a=void 0===e.height?0:e.height,s=void 0===e.internalFillColor?"#00AA00":e.internalFillColor,c=void 0===e.internalLineWidth?2:e.internalLineWidth,S=void 0===e.internalStrokeColor?"#003300":e.internalStrokeColor,r=void 0===e.externalLineWidth?2:e.externalLineWidth,u=void 0===e.externalStrokeColor?"#008000":e.externalStrokeColor,$=void 0===e.autoReturnToCenter||e.autoReturnToCenter;i=i||function(t){};var d=document.getElementById(t);d.style.touchAction="none";var h=document.createElement("canvas");h.id=o,0===n&&(n=d.clientWidth),0===a&&(a=d.clientHeight),h.width=n,h.height=a,d.appendChild(h);var k=h.getContext("2d"),l=0,f=2*Math.PI,y=(h.width-(h.width/2+10))/2,v=y+5,_=y+30,p=h.width/2,P=h.height/2,x=h.width/10,g=-1*x,T=h.height/10,E=-1*T,C=p,w=P;function L(){k.beginPath(),k.arc(p,P,_,0,f,!1),k.lineWidth=r,k.strokeStyle=u,k.stroke()}function F(){k.beginPath(),C<y&&(C=v),C+y>h.width&&(C=h.width-v),w<y&&(w=v),w+y>h.height&&(w=h.height-v),k.arc(C,w,y,0,f,!1);var t=k.createRadialGradient(p,P,5,p,P,200);t.addColorStop(0,s),t.addColorStop(1,S),k.fillStyle=t,k.fill(),k.lineWidth=c,k.strokeStyle=S,k.stroke()}function m(){let t="",e=C-p,i=w-P;return i>=E&&i<=T&&(t="C"),i<E&&(t="N"),i>T&&(t="S"),e<g&&("C"===t?t="W":t+="W"),e>x&&("C"===t?t="E":t+="E"),t}"ontouchstart"in document.documentElement?(h.addEventListener("touchstart",function t(e){l=1,StickStatus.xPosition=0,StickStatus.yPosition=0,StickStatus.x=0,StickStatus.y=0,StickStatus.cardinalDirection=m(),StickStatus.eventType=JoyStickEventType.Press,i(StickStatus)},!1),document.addEventListener("touchmove",function t(e){1===l&&e.targetTouches[0].target===h&&(C=e.targetTouches[0].pageX,w=e.targetTouches[0].pageY,"BODY"===h.offsetParent.tagName.toUpperCase()?(C-=h.offsetLeft,w-=h.offsetTop):(C-=h.offsetParent.offsetLeft,w-=h.offsetParent.offsetTop),k.clearRect(0,0,h.width,h.height),L(),F(),StickStatus.xPosition=C,StickStatus.yPosition=w,StickStatus.x=(100*((C-p)/v)).toFixed(),StickStatus.y=(-(100*((w-P)/v)*1)).toFixed(),StickStatus.cardinalDirection=m(),StickStatus.eventType=JoyStickEventType.PressMove,i(StickStatus))},!1),document.addEventListener("touchend",function t(e){l=0,$&&(C=p,w=P),k.clearRect(0,0,h.width,h.height),L(),F(),StickStatus.xPosition=C,StickStatus.yPosition=w,StickStatus.x=(100*((C-p)/v)).toFixed(),StickStatus.y=(-(100*((w-P)/v)*1)).toFixed(),StickStatus.cardinalDirection=m(),StickStatus.eventType=JoyStickEventType.Release,i(StickStatus)},!1)):(h.addEventListener("mousedown",function t(e){l=1,StickStatus.xPosition=0,StickStatus.yPosition=0,StickStatus.x=0,StickStatus.y=0,StickStatus.cardinalDirection=m(),StickStatus.eventType=JoyStickEventType.Press,i(StickStatus)},!1),document.addEventListener("mousemove",function t(e){1===l&&(C=e.pageX,w=e.pageY,"BODY"===h.offsetParent.tagName.toUpperCase()?(C-=h.offsetLeft,w-=h.offsetTop):(C-=h.offsetParent.offsetLeft,w-=h.offsetParent.offsetTop),k.clearRect(0,0,h.width,h.height),L(),F(),StickStatus.xPosition=C,StickStatus.yPosition=w,StickStatus.x=(100*((C-p)/v)).toFixed(),StickStatus.y=(-(100*((w-P)/v)*1)).toFixed(),StickStatus.cardinalDirection=m(),StickStatus.eventType=JoyStickEventType.PressMove,i(StickStatus))},!1),document.addEventListener("mouseup",function t(e){l=0,$&&(C=p,w=P),k.clearRect(0,0,h.width,h.height),L(),F(),StickStatus.xPosition=C,StickStatus.yPosition=w,StickStatus.x=(100*((C-p)/v)).toFixed(),StickStatus.y=(-(100*((w-P)/v)*1)).toFixed(),StickStatus.cardinalDirection=m(),StickStatus.eventType=JoyStickEventType.Release,i(StickStatus)},!1)),L(),F(),this.GetWidth=function(){return h.width},this.GetHeight=function(){return h.height},this.GetPosX=function(){return C},this.GetPosY=function(){return w},this.GetX=function(){return(100*((C-p)/v)).toFixed()},this.GetY=function(){return(-(100*((w-P)/v)*1)).toFixed()},this.GetDir=function(){return m()}};